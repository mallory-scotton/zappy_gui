///////////////////////////////////////////////////////////////////////////////
// Header guard
///////////////////////////////////////////////////////////////////////////////
#pragma once

///////////////////////////////////////////////////////////////////////////////
// Dependencies
///////////////////////////////////////////////////////////////////////////////
#include "Game/Inventory.hpp"
#include "Graphics/Animations/Animation.hpp"
#include "Game/Team.hpp"
#include <SFML/Graphics.hpp>
#include <SFML/Window.hpp>
#include <SFML/System.hpp>
#include <vector>

///////////////////////////////////////////////////////////////////////////////
// Namespace Zappy
///////////////////////////////////////////////////////////////////////////////
namespace Zappy
{

///////////////////////////////////////////////////////////////////////////////
/// \brief
///
///////////////////////////////////////////////////////////////////////////////
class Viewport
{
private:
    ///////////////////////////////////////////////////////////////////////////
    // Constants
    ///////////////////////////////////////////////////////////////////////////
    static constexpr unsigned int DEFAULT_WIDTH = 800;
    static constexpr unsigned int DEFAULT_HEIGHT = 600;
    static constexpr float DEFAULT_ZOOM = 1.0f;
    static constexpr float MIN_ZOOM = 0.1f;
    static constexpr float MAX_ZOOM = 1.2f;
    static constexpr float TILE_SIZE = 64.0f;

private:
    ///////////////////////////////////////////////////////////////////////////
    // Private members
    ///////////////////////////////////////////////////////////////////////////
    sf::View m_view;                //< The SFML view for the viewport
    sf::RenderTexture m_texture;    //< The texture used for rendering
    float m_zoom;                   //< The zoom level of the viewport
    bool m_isDragging;              //< Indicate if the viewport is being dragged
    sf::Vector2f m_lastMousePos;    //< The last mouse position when dragging
    float m_viewportX;              //< The X position of the viewport
    float m_viewportY;              //< The Y position of the viewport
    bool m_forceRender;             //< Flag to force rendering
    sf::Font m_font;                //< The font used for rendering text
    bool m_fontLoaded = false;      //< Flag to check if the font is loaded
    sf::Text m_text;                //< The text object for rendering resources
    std::vector<Animation> m_activeAnimations;

public:
    struct ResourceDisplay {
        unsigned int value;
        sf::Color color;
        char symbol;
    };

    std::vector<ResourceDisplay> m_resources;

public:
    ///////////////////////////////////////////////////////////////////////////
    /// \brief Constructor for the Viewport class
    ///
    ///////////////////////////////////////////////////////////////////////////
    Viewport(void);

public:
    ///////////////////////////////////////////////////////////////////////////
    /// \brief Get the texture id of the viewport
    ///
    /// \return The texture ID of the viewport
    ///
    ///////////////////////////////////////////////////////////////////////////
    unsigned int GetTextureID(void) const;

    ///////////////////////////////////////////////////////////////////////////
    /// \brief Render the viewport
    ///
    ///////////////////////////////////////////////////////////////////////////
    void Render(void);

    ///////////////////////////////////////////////////////////////////////////
    /// \brief Resize the viewport
    ///
    /// \param width The width of the viewport
    /// \param height The height of the viewport
    ///
    /// \return True if the viewport was resized successfully, false otherwise
    ///
    ///////////////////////////////////////////////////////////////////////////
    bool Resize(unsigned int width, unsigned int height);

    ///////////////////////////////////////////////////////////////////////////
    /// \brief Get the size of the viewport
    ///
    /// \return The size of the viewport as a sf::Vector2u
    ///
    ///////////////////////////////////////////////////////////////////////////
    sf::Vector2u GetSize(void) const;

    ///////////////////////////////////////////////////////////////////////////
    /// \brief Handle an SFML event
    ///
    /// \param event The SFML event to handle
    ///
    ///////////////////////////////////////////////////////////////////////////
    void ProcessEvent(const sf::Event& event);

    ///////////////////////////////////////////////////////////////////////////
    /// \brief Set the viewport position
    ///
    /// \param x The X position of the viewport
    /// \param y The Y position of the viewport
    ///
    ///////////////////////////////////////////////////////////////////////////
    void SetViewportPosition(float x, float y);

private:
    ///////////////////////////////////////////////////////////////////////////
    /// \brief Zoom the viewport
    ///
    /// \param factor The zoom factor to apply
    ///
    ///////////////////////////////////////////////////////////////////////////
    void Zoom(float factor);

    ///////////////////////////////////////////////////////////////////////////
    /// \brief Render the grid on the viewport
    ///
    ///////////////////////////////////////////////////////////////////////////
    void RenderGrid(void);

    ///////////////////////////////////////////////////////////////////////////
    /// \brief Render the players on the viewport
    ///
    ///////////////////////////////////////////////////////////////////////////
    void RenderPlayers(void);

    ///////////////////////////////////////////////////////////////////////////
    /// \brief Get the resources at a specific inventory
    ///
    /// \param inv The inventory to check for resources
    ///
    /// \return A vector of ResourceDisplay objects representing the resources
    ///
    ///////////////////////////////////////////////////////////////////////////
    std::vector<ResourceDisplay>& GetResources(const Inventory& inv);

    ///////////////////////////////////////////////////////////////////////////
    /// \brief Render the winner of the game
    ///
    ///////////////////////////////////////////////////////////////////////////
    void RenderWinner(const Team& team);

    ///////////////////////////////////////////////////////////////////////////
    /// \brief Process animation events from GameState and create animations
    ///
    ///////////////////////////////////////////////////////////////////////////
    void ProcessAnimationEvents(void);

    ///////////////////////////////////////////////////////////////////////////
    /// \brief Update and render active animations
    ///
    ///////////////////////////////////////////////////////////////////////////
    void UpdateAndRenderAnimations(void);
};

} // !namespace Zappy
